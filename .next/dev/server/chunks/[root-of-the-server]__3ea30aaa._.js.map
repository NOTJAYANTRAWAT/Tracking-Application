{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nconst uri = process.env.MONGODB_URI;\r\n\r\nif (!uri) {\r\n  throw new Error(\"MONGODB_URI is not defined\");\r\n}\r\n\r\nconst options = {};\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\ndeclare global {\r\n  // allow global var in Node.js\r\n  // eslint-disable-next-line no-var\r\n  var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n}\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  if (!global._mongoClientPromise) {\r\n    client = new MongoClient(uri, options);\r\n    global._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = global._mongoClientPromise;\r\n} else {\r\n  client = new MongoClient(uri, options);\r\n  clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAQJ,wCAA4C;IAC1C,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,OAAO,mBAAmB;AAC5C;;uCAKe"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/app/api/mobilelocation/route.ts"],"sourcesContent":["import clientPromise from \"@/lib/mongodb\";\r\n\r\nexport async function POST(req: Request) {\r\n  const data = await req.json();\r\n  const client = await clientPromise;\r\n  const db = client.db(\"helicopterTracker\");\r\n\r\n  // Consistent with your MongoDB Data Explorer\r\n  await db.collection(\"mobileTrips\").insertOne(data); \r\n\r\n  return Response.json({ status: \"saved\" });\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const { searchParams } = new URL(req.url);\r\n  const agentId = searchParams.get(\"agent_id\");\r\n  const tripId = searchParams.get(\"trip_id\");\r\n  const latest = searchParams.get(\"latest\");\r\n  const recent = searchParams.get(\"recent\"); // üîπ Critical addition\r\n\r\n  const client = await clientPromise;\r\n  const db = client.db(\"helicopterTracker\");\r\n  const collection = db.collection(\"mobileTrips\");\r\n\r\n  // üõ∞Ô∏è LIVE FLEET LOGIC: Triggered when \"Activate Live Fleet\" is ON\r\n  if (recent === \"true\") {\r\n    // Fetch locations from the last 5 minutes to identify \"Active\" agents\r\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();\r\n    \r\n    const activeAgents = await collection.aggregate([\r\n      { $match: { timestamp: { $gte: fiveMinutesAgo } } },\r\n      { $sort: { timestamp: -1 } },\r\n      { $group: {\r\n          _id: \"$trip_id\",\r\n          latitude: { $first: \"$latitude\" },\r\n          longitude: { $first: \"$longitude\" },\r\n          agent_id: { $first: \"$agent_id\" },\r\n          trip_id: { $first: \"$trip_id\" }\r\n      }}\r\n    ]).toArray();\r\n\r\n    return Response.json(activeAgents);\r\n  }\r\n\r\n  // Handle trip_id (History)\r\n  if (tripId) {\r\n    const history = await collection.find({ trip_id: tripId }).sort({ timestamp: 1 }).toArray();\r\n    return Response.json(history);\r\n  }\r\n\r\n  // Handle agent_id\r\n  if (agentId) {\r\n    if (latest === \"true\") {\r\n      const latestPoint = await collection.find({ agent_id: agentId }).sort({ timestamp: -1 }).limit(1).toArray();\r\n      return Response.json(latestPoint[0] || null);\r\n    }\r\n    const history = await collection.find({ agent_id: agentId }).sort({ timestamp: 1 }).toArray();\r\n    return Response.json(history);\r\n  }\r\n\r\n  // Default: Return unique Trip IDs for the sidebar\r\n  const tripIds = await collection.distinct(\"trip_id\");\r\n  return Response.json(tripIds);\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,MAAM,2HAAa;IAClC,MAAM,KAAK,OAAO,EAAE,CAAC;IAErB,6CAA6C;IAC7C,MAAM,GAAG,UAAU,CAAC,eAAe,SAAS,CAAC;IAE7C,OAAO,SAAS,IAAI,CAAC;QAAE,QAAQ;IAAQ;AACzC;AAEO,eAAe,IAAI,GAAY;IACpC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,UAAU,aAAa,GAAG,CAAC;IACjC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,SAAS,aAAa,GAAG,CAAC,WAAW,uBAAuB;IAElE,MAAM,SAAS,MAAM,2HAAa;IAClC,MAAM,KAAK,OAAO,EAAE,CAAC;IACrB,MAAM,aAAa,GAAG,UAAU,CAAC;IAEjC,mEAAmE;IACnE,IAAI,WAAW,QAAQ;QACrB,sEAAsE;QACtE,MAAM,iBAAiB,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,MAAM,WAAW;QAEvE,MAAM,eAAe,MAAM,WAAW,SAAS,CAAC;YAC9C;gBAAE,QAAQ;oBAAE,WAAW;wBAAE,MAAM;oBAAe;gBAAE;YAAE;YAClD;gBAAE,OAAO;oBAAE,WAAW,CAAC;gBAAE;YAAE;YAC3B;gBAAE,QAAQ;oBACN,KAAK;oBACL,UAAU;wBAAE,QAAQ;oBAAY;oBAChC,WAAW;wBAAE,QAAQ;oBAAa;oBAClC,UAAU;wBAAE,QAAQ;oBAAY;oBAChC,SAAS;wBAAE,QAAQ;oBAAW;gBAClC;YAAC;SACF,EAAE,OAAO;QAEV,OAAO,SAAS,IAAI,CAAC;IACvB;IAEA,2BAA2B;IAC3B,IAAI,QAAQ;QACV,MAAM,UAAU,MAAM,WAAW,IAAI,CAAC;YAAE,SAAS;QAAO,GAAG,IAAI,CAAC;YAAE,WAAW;QAAE,GAAG,OAAO;QACzF,OAAO,SAAS,IAAI,CAAC;IACvB;IAEA,kBAAkB;IAClB,IAAI,SAAS;QACX,IAAI,WAAW,QAAQ;YACrB,MAAM,cAAc,MAAM,WAAW,IAAI,CAAC;gBAAE,UAAU;YAAQ,GAAG,IAAI,CAAC;gBAAE,WAAW,CAAC;YAAE,GAAG,KAAK,CAAC,GAAG,OAAO;YACzG,OAAO,SAAS,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI;QACzC;QACA,MAAM,UAAU,MAAM,WAAW,IAAI,CAAC;YAAE,UAAU;QAAQ,GAAG,IAAI,CAAC;YAAE,WAAW;QAAE,GAAG,OAAO;QAC3F,OAAO,SAAS,IAAI,CAAC;IACvB;IAEA,kDAAkD;IAClD,MAAM,UAAU,MAAM,WAAW,QAAQ,CAAC;IAC1C,OAAO,SAAS,IAAI,CAAC;AACvB"}}]
}