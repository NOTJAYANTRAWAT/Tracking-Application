{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/app/agentadmin/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\ninterface Flight {\r\n  id: string;\r\n  agentId: string;\r\n  date: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  durationLabel: string;\r\n  distance: number;\r\n  status: \"ACTIVE\" | \"COMPLETED\";\r\n  color: string;\r\n  latlngs?: [number, number][]; \r\n}\r\n\r\nexport default function Admin() {\r\n  const mapRef = useRef<any>(null);\r\n  const LRef = useRef<any>(null);\r\n  const layersRef = useRef<Record<string, any>>({}); \r\n\r\n  const [flights, setFlights] = useState<Flight[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [playing, setPlaying] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    async function init() {\r\n      const LModule = await import(\"leaflet\");\r\n      const L = LModule.default || LModule;\r\n      LRef.current = L;\r\n\r\n      // Dark theme map for better visibility of tracking lines\r\n      mapRef.current = L.map(\"adminMap\", { zoomControl: false }).setView([19.0176, 72.8561], 13);\r\n      L.control.zoom({ position: 'bottomright' }).addTo(mapRef.current);\r\n\r\n      L.tileLayer(\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\", {\r\n        attribution: '&copy; CartoDB'\r\n      }).addTo(mapRef.current);\r\n\r\n      fetchSummaries();\r\n    }\r\n    init();\r\n  }, []);\r\n\r\n  // Generate consistent color based on Agent ID\r\n  function getAgentColor(name: string) {\r\n    const colors = [\"#3b82f6\", \"#10b981\", \"#f59e0b\", \"#ef4444\", \"#8b5cf6\", \"#ec4899\"];\r\n    let hash = 0;\r\n    for (let i = 0; i < name.length; i++) {\r\n      hash = name.charCodeAt(i) + ((hash << 5) - hash);\r\n    }\r\n    return colors[Math.abs(hash) % colors.length];\r\n  }\r\n\r\n  async function fetchSummaries() {\r\n    try {\r\n      const res = await fetch(\"/api/mobilelocation\");\r\n      const ids = await res.json();\r\n      \r\n      const summaries: Flight[] = ids.map((id: string) => {\r\n        // Assume ID format like \"AGENTID-TIMESTAMP\"\r\n        const agentId = id.includes('-') ? id.split('-')[0] : \"Agent\";\r\n        return {\r\n          id,\r\n          agentId,\r\n          status: \"COMPLETED\",\r\n          color: getAgentColor(agentId),\r\n          durationLabel: \"Click Focus to Load\",\r\n          distance: 0,\r\n        };\r\n      });\r\n\r\n      setFlights(summaries);\r\n      setLoading(false);\r\n    } catch (e) {\r\n      console.error(\"Dashboard failed to load\", e);\r\n    }\r\n  }\r\n\r\n  async function loadPath(id: string) {\r\n    if (layersRef.current[id]) return layersRef.current[id].latlngs;\r\n\r\n    const res = await fetch(`/api/mobilelocation?trip_id=${id}`);\r\n    const history = await res.json();\r\n    if (!history.length) return null;\r\n\r\n    const L = LRef.current;\r\n    const latlngs: [number, number][] = history.map((p: any) => [p.latitude, p.longitude]);\r\n    const agentId = history[0].agent_id || \"Agent\";\r\n    const color = getAgentColor(agentId);\r\n\r\n    const polyline = L.polyline(latlngs, { color, weight: 3, opacity: 0.8 });\r\n    \r\n    // Cleaner pinpoint marker\r\n    const lastPoint = latlngs[latlngs.length - 1];\r\n    const marker = L.circleMarker(lastPoint, {\r\n      radius: 6,\r\n      fillColor: color,\r\n      color: \"#fff\",\r\n      weight: 2,\r\n      fillOpacity: 1\r\n    });\r\n\r\n    const group = L.featureGroup([polyline, marker]).addTo(mapRef.current);\r\n    layersRef.current[id] = { group, polyline, latlngs };\r\n    \r\n    return latlngs;\r\n  }\r\n\r\n  async function focusFlight(id: string) {\r\n    const latlngs = await loadPath(id);\r\n    if (latlngs) {\r\n      mapRef.current.fitBounds(layersRef.current[id].group.getBounds(), { padding: [40, 40] });\r\n    }\r\n  }\r\n\r\n  async function replayFlight(id: string) {\r\n    if (playing) return;\r\n    setPlaying(id);\r\n    const latlngs = await loadPath(id);\r\n    if (!latlngs) return;\r\n\r\n    const poly = layersRef.current[id].polyline;\r\n    poly.setLatLngs([]);\r\n\r\n    for (let i = 0; i < latlngs.length; i++) {\r\n      poly.addLatLng(latlngs[i]);\r\n      if (i % 3 === 0) await new Promise(r => setTimeout(r, 20));\r\n    }\r\n    setPlaying(null);\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen bg-[#0b0e14] text-gray-300 font-sans flex flex-col overflow-hidden\">\r\n      {/* Top Telemetry Bar */}\r\n      <div className=\"flex justify-between px-6 py-4 bg-[#161b22] border-b border-gray-800 items-center\">\r\n        <h1 className=\"text-blue-500 font-bold tracking-tighter text-xl\">HELICOPTER <span className=\"text-white\">RADAR</span></h1>\r\n        <div className=\"flex gap-8 text-[10px] uppercase tracking-widest font-bold\">\r\n          <div className=\"flex flex-col\"><span className=\"text-gray-500\">Fleet Count</span><span className=\"text-white text-lg\">{flights.length}</span></div>\r\n          <div className=\"flex flex-col\"><span className=\"text-gray-500\">Uptime</span><span className=\"text-green-500 text-lg\">99.9%</span></div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-1 overflow-hidden\">\r\n        {/* Radar Sidebar */}\r\n        <div className=\"w-80 bg-[#0b0e14] border-r border-gray-800 overflow-y-auto\">\r\n          {loading ? (\r\n            <div className=\"p-10 text-center animate-pulse text-blue-500 font-bold\">BOOTING SYSTEM...</div>\r\n          ) : (\r\n            flights.map(flight => (\r\n              <div key={flight.id} className=\"p-4 border-b border-gray-800 hover:bg-[#161b22] transition-colors\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full shadow-[0_0_8px] shadow-current\" style={{ color: flight.color, backgroundColor: flight.color }} />\r\n                    <span className=\"text-xs font-bold text-white uppercase\">{flight.agentId}</span>\r\n                  </div>\r\n                  <span className=\"text-[9px] text-gray-600 bg-gray-900 px-2 py-0.5 rounded\">{flight.id.slice(-6)}</span>\r\n                </div>\r\n                \r\n                <div className=\"flex gap-2\">\r\n                  <button onClick={() => focusFlight(flight.id)} className=\"flex-1 bg-gray-800 hover:bg-gray-700 py-2 rounded text-[10px] font-bold text-white uppercase tracking-tighter transition\">Focus</button>\r\n                  <button onClick={() => replayFlight(flight.id)} className=\"flex-1 border border-blue-500/30 text-blue-500 hover:bg-blue-500/10 py-2 rounded text-[10px] font-bold uppercase transition\">\r\n                    {playing === flight.id ? \"Replaying\" : \"Replay\"}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Global Map View */}\r\n        <div id=\"adminMap\" className=\"flex-1 h-full bg-[#0b0e14]\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 360, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;KAElC;IACL,IAAIF,QAAQC,GAAG,CAACK,yBAAyB,EAAE;;SAcpC;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;QAGT,OAAO;;IAOT;AACF","ignoreList":[0]}},
    {"offset": {"line": 379, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0]}},
    {"offset": {"line": 384, "column": 0}, "map": {"version":3,"sources":["file:///C:/Tracking%20Application/helicopter-tracker/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n"],"names":["module","exports","require","vendored","React"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,KAAK","ignoreList":[0]}}]
}