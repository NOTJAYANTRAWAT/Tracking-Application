(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23261,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function s(){let s=(0,a.useRef)(null),r=(0,a.useRef)({}),n=(0,a.useRef)(null),[i,l]=(0,a.useState)([]),[c,o]=(0,a.useState)("routes"),[d,u]=(0,a.useState)(null);async function m(e){let t=await fetch("/api/location"),a=await t.json(),i=[],c=[];for(let t of a){let a=await fetch(`/api/location?device_id=${t}`),n=await a.json();if(!n.length)continue;let l=n[0],o=n[n.length-1],d=new Date(l.timestamp),u=new Date(o.timestamp),m=(u.getTime()-d.getTime())/1e3,h=m>60?`${Math.floor(m/60)}m ${Math.floor(m%60)}s`:`${Math.floor(m)}s`,f=n.map(e=>(c.push([e.latitude,e.longitude,.4]),[e.latitude,e.longitude])),x=function(){let e=["#00ff00","#00ffff","#ff00ff","#ffff00","#00ff88"];return e[Math.floor(Math.random()*e.length)]}(),p=e.polyline(f,{color:x,weight:3}).addTo(s.current);r.current[t]=p;let g=Date.now()-u.getTime()<15e3;i.push({id:t,date:d.toLocaleDateString(),startTime:d.toLocaleTimeString(),endTime:u.toLocaleTimeString(),durationSec:m,durationLabel:h,distance:function(e){let t=0;for(let a=1;a<e.length;a++)t+=function(e,t,a,s){let r=Math.sin((a-e)*Math.PI/180/2)**2+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin((s-t)*Math.PI/180/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}(e[a-1].latitude,e[a-1].longitude,e[a].latitude,e[a].longitude);return t}(n),status:g?"ACTIVE":"COMPLETED",latlngs:f,color:x})}n.current=e.heatLayer(c,{radius:25,blur:15}),l(i)}function h(e){o(e),"heatmap"===e?(Object.values(r.current).forEach(e=>s.current.removeLayer(e)),n.current.addTo(s.current)):(s.current.removeLayer(n.current),Object.values(r.current).forEach(e=>e.addTo(s.current)))}async function f(e){u(e),Object.values(r.current).forEach(e=>s.current.removeLayer(e));let t=r.current[e];t.addTo(s.current);let a=i.find(t=>t.id===e)?.latlngs||[];for(let e=0;e<a.length;e++)t.setLatLngs(a.slice(0,e)),await new Promise(e=>setTimeout(e,80));await new Promise(e=>setTimeout(e,800)),Object.values(r.current).forEach(e=>e.addTo(s.current)),u(null)}(0,a.useEffect)(()=>((async function(){let t=await e.A(71400),a=t.default||t;window.L=a,await e.A(54746),delete a.Icon.Default.prototype._getIconUrl,a.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}),s.current=a.map("adminMap").setView([28.6139,77.209],12),a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(s.current),m(a)})(),()=>{s.current&&s.current.remove()}),[]);let x=i.reduce((e,t)=>e+t.distance,0),p=i.reduce((e,t)=>e+t.durationSec,0)/(i.length||1);return(0,t.jsxs)("div",{className:"h-screen bg-black text-green-400 font-mono flex flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex justify-between px-6 py-4 border-b border-green-500/30 text-sm",children:[(0,t.jsxs)("div",{children:["TOTAL: ",i.length]}),(0,t.jsxs)("div",{children:["ACTIVE: ",i.filter(e=>"ACTIVE"===e.status).length]}),(0,t.jsxs)("div",{children:["COMPLETED: ",i.filter(e=>"COMPLETED"===e.status).length]}),(0,t.jsxs)("div",{children:["AVG DURATION: ",p.toFixed(1),"s"]}),(0,t.jsxs)("div",{children:["TOTAL DIST: ",x.toFixed(2)," km"]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>h("routes"),className:"border px-3 py-1",children:"ROUTES"}),(0,t.jsx)("button",{onClick:()=>h("heatmap"),className:"border px-3 py-1",children:"HEATMAP"})]})]}),(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,t.jsx)("div",{className:"w-96 p-4 border-r border-green-500/20 overflow-y-auto h-full",children:i.map(e=>(0,t.jsxs)("div",{className:"mb-4 p-4 border border-green-500/30 bg-green-500/5 hover:bg-green-500/10 transition",children:[(0,t.jsx)("div",{className:"text-xs opacity-70",children:e.id}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:e.date}),(0,t.jsxs)("div",{className:"text-xs opacity-70",children:[e.startTime," â†’ ",e.endTime]}),(0,t.jsxs)("div",{className:"mt-2 text-sm",children:["DURATION: ",e.durationLabel]}),(0,t.jsxs)("div",{className:"text-sm",children:["DIST: ",e.distance.toFixed(2)," km"]}),(0,t.jsxs)("div",{className:`text-sm mt-1 ${"ACTIVE"===e.status?"animate-pulse":"opacity-60"}`,children:["STATUS: ",e.status]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,t.jsx)("button",{onClick:()=>{var t;let a;return t=e.id,a=r.current[t],void s.current.fitBounds(a.getBounds())},className:"flex-1 border px-2 py-1 text-xs",children:"FOCUS"}),(0,t.jsx)("button",{onClick:()=>f(e.id),className:"flex-1 border px-2 py-1 text-xs",children:"REPLAY"})]}),d===e.id&&(0,t.jsx)("div",{className:"text-xs mt-2 animate-pulse",children:"REPLAYING..."})]},e.id))}),(0,t.jsx)("div",{id:"adminMap",className:"flex-1 h-full"})]})]})}e.s(["default",()=>s])},71400,e=>{e.v(t=>Promise.all(["static/chunks/9c09817456a99b20.js"].map(t=>e.l(t))).then(()=>t(32322)))},54746,e=>{e.v(t=>Promise.all(["static/chunks/c5f5821b600f6059.js"].map(t=>e.l(t))).then(()=>t(71434)))}]);