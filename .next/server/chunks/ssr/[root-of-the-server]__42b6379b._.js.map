{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../app/history/page.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\ninterface FlightSummary {\r\n  id: string;\r\n  duration: string;\r\n  start: { lat: number; lng: number };\r\n  end: { lat: number; lng: number };\r\n  distance: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  date: string;\r\n}\r\n\r\nexport default function History() {\r\n  const mapRef = useRef<any>(null);\r\n  const markerRef = useRef<any>(null);\r\n  const polylineRef = useRef<any>(null);\r\n\r\n  const [flights, setFlights] = useState<FlightSummary[]>([]);\r\n  const [playing, setPlaying] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    let L: any;\r\n\r\n    async function init() {\r\n      L = await import(\"leaflet\");\r\n\r\n      delete (L.Icon.Default.prototype as any)._getIconUrl;\r\n      L.Icon.Default.mergeOptions({\r\n        iconRetinaUrl:\r\n          \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png\",\r\n        iconUrl:\r\n          \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\r\n        shadowUrl:\r\n          \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n      });\r\n\r\n      mapRef.current = L.map(\"map\", {\r\n        zoomControl: false,\r\n      }).setView([28.6139, 77.2090], 13);\r\n\r\n      L.tileLayer(\r\n        \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n        {\r\n          attribution: \"\",\r\n        }\r\n      ).addTo(mapRef.current);\r\n\r\n      markerRef.current = L.marker([28.6139, 77.2090]).addTo(mapRef.current);\r\n      polylineRef.current = L.polyline([], {\r\n        color: \"#00ff00\",\r\n        weight: 3,\r\n      }).addTo(mapRef.current);\r\n\r\n      loadFlights();\r\n    }\r\n\r\n    async function loadFlights() {\r\n    const res = await fetch(\"/api/location\");\r\n    const deviceIds = await res.json();\r\n\r\n    const summaries: FlightSummary[] = [];\r\n\r\n    for (let id of deviceIds) {\r\n        const resHistory = await fetch(\r\n        `/api/location?device_id=${id}`\r\n        );\r\n        const history = await resHistory.json();\r\n\r\n        if (!history.length) continue;\r\n\r\n        const start = history[0];\r\n        const end = history[history.length - 1];\r\n\r\n        // ✅ Timestamp logic INSIDE loop\r\n        const startDate = new Date(start.timestamp);\r\n        const endDate = new Date(end.timestamp);\r\n\r\n        const date = startDate.toLocaleDateString();\r\n        const startTime = startDate.toLocaleTimeString();\r\n        const endTime = endDate.toLocaleTimeString();\r\n\r\n        const durationMs =\r\n        endDate.getTime() - startDate.getTime();\r\n\r\n        const durationSec = Math.floor(durationMs / 1000);\r\n\r\n        const duration =\r\n        durationSec > 60\r\n            ? `${Math.floor(durationSec / 60)}m ${durationSec % 60}s`\r\n            : `${durationSec}s`;\r\n\r\n        const distance = calculateDistance(history);\r\n\r\n        summaries.push({\r\n        id,\r\n        duration,\r\n        start: { lat: start.latitude, lng: start.longitude },\r\n        end: { lat: end.latitude, lng: end.longitude },\r\n        distance: `${distance.toFixed(2)} km`,\r\n        startTime,\r\n        endTime,\r\n        date,\r\n        });\r\n    }\r\n\r\n    setFlights(summaries);\r\n    }\r\n\r\n\r\n    init();\r\n\r\n    return () => {\r\n      if (mapRef.current) mapRef.current.remove();\r\n    };\r\n  }, []);\r\n\r\n  function calculateDistance(history: any[]) {\r\n    let total = 0;\r\n\r\n    for (let i = 1; i < history.length; i++) {\r\n      total += haversine(\r\n        history[i - 1].latitude,\r\n        history[i - 1].longitude,\r\n        history[i].latitude,\r\n        history[i].longitude\r\n      );\r\n    }\r\n\r\n    return total;\r\n  }\r\n\r\n  function haversine(\r\n    lat1: number,\r\n    lon1: number,\r\n    lat2: number,\r\n    lon2: number\r\n  ) {\r\n    const R = 6371;\r\n    const dLat = ((lat2 - lat1) * Math.PI) / 180;\r\n    const dLon = ((lon2 - lon1) * Math.PI) / 180;\r\n\r\n    const a =\r\n      Math.sin(dLat / 2) ** 2 +\r\n      Math.cos((lat1 * Math.PI) / 180) *\r\n        Math.cos((lat2 * Math.PI) / 180) *\r\n        Math.sin(dLon / 2) ** 2;\r\n\r\n    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  }\r\n\r\n  async function replayFlight(id: string) {\r\n    setPlaying(id);\r\n    polylineRef.current.setLatLngs([]);\r\n\r\n    const res = await fetch(`/api/location?device_id=${id}`);\r\n    const history = await res.json();\r\n\r\n    const bounds = history.map((p: any) => [\r\n      p.latitude,\r\n      p.longitude,\r\n    ]);\r\n\r\n    mapRef.current.fitBounds(bounds);\r\n\r\n    for (let point of history) {\r\n      const latlng: [number, number] = [\r\n        point.latitude,\r\n        point.longitude,\r\n      ];\r\n\r\n      markerRef.current.setLatLng(latlng);\r\n      polylineRef.current.addLatLng(latlng);\r\n\r\n      await new Promise((r) => setTimeout(r, 120));\r\n    }\r\n\r\n    setPlaying(null);\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-black text-green-400 font-mono\">\r\n      {/* Radar Sidebar */}\r\n      <div className=\"w-96 p-6 overflow-y-auto border-r border-green-500/20\">\r\n        <h2 className=\"text-2xl mb-6 tracking-widest\">\r\n          ✈ FLIGHT LOG\r\n        </h2>\r\n\r\n        {flights.map((flight) => (\r\n          <div\r\n            key={flight.id}\r\n            className=\"mb-6 p-4 border border-green-500/30\r\n                       bg-green-500/5\r\n                       hover:bg-green-500/10\r\n                       transition\"\r\n          >\r\n            <div className=\"text-xs opacity-70 mb-2\">\r\n              {flight.id}\r\n            </div>\r\n            <div className=\"text-sm opacity-70\">\r\n            DATE: {flight.date}\r\n            </div>\r\n            <div className=\"text-sm opacity-70\">\r\n            TIME: {flight.startTime} → {flight.endTime}\r\n            </div>\r\n\r\n            <div className=\"text-sm\">\r\n            DURATION: {flight.duration}\r\n            </div>\r\n\r\n            <div className=\"text-sm\">\r\n            DISTANCE: {flight.distance}\r\n            </div>\r\n\r\n            <div className=\"text-sm\">\r\n            START: {flight.start.lat.toFixed(3)}, {flight.start.lng.toFixed(3)}\r\n            </div>\r\n\r\n            <div className=\"text-sm\">\r\n            END: {flight.end.lat.toFixed(3)}, {flight.end.lng.toFixed(3)}\r\n            </div>\r\n\r\n            <div className=\"text-sm\">\r\n              DURATION: {flight.duration}\r\n            </div>\r\n            <div className=\"text-sm\">\r\n              DISTANCE: {flight.distance}\r\n            </div>\r\n            <div className=\"text-sm\">\r\n              START: {flight.start.lat.toFixed(3)}, {flight.start.lng.toFixed(3)}\r\n            </div>\r\n            <div className=\"text-sm\">\r\n              END: {flight.end.lat.toFixed(3)}, {flight.end.lng.toFixed(3)}\r\n            </div>\r\n\r\n            <button\r\n              onClick={() => replayFlight(flight.id)}\r\n              className=\"mt-4 w-full border border-green-400\r\n                         hover:bg-green-500 hover:text-black\r\n                         py-2 transition\"\r\n            >\r\n              ▶ REPLAY\r\n            </button>\r\n\r\n            {playing === flight.id && (\r\n              <div className=\"mt-2 text-xs animate-pulse\">\r\n                REPLAYING...\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Map */}\r\n      <div id=\"map\" className=\"flex-1\" />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}